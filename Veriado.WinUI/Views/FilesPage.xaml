<?xml version="1.0" encoding="utf-8"?>
<Page
    x:Class="Veriado.Views.FilesPage"
    x:Name="PageRoot"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:i="using:Microsoft.Xaml.Interactivity"
    xmlns:core="using:Microsoft.Xaml.Interactions.Core"
    xmlns:ctb="using:CommunityToolkit.WinUI.Behaviors"
    xmlns:trig="using:CommunityToolkit.WinUI.Triggers"
    xmlns:controls="using:CommunityToolkit.WinUI.Controls"
    xmlns:muxc="using:Microsoft.UI.Xaml.Controls"
    xmlns:models="using:Veriado.Models.Files"
    xmlns:vm="using:Veriado.ViewModels.Files"
    NavigationCacheMode="Enabled"
    x:DataType="vm:FilesGridViewModel">

  <i:Interaction.Behaviors>
    <ctb:EventToCommandBehavior EventName="Loaded" Command="{Binding RefreshCommand}" />
  </i:Interaction.Behaviors>

  <Grid Padding="24" RowSpacing="16">
    <Grid.RowDefinitions>
      <RowDefinition Height="Auto" />
      <RowDefinition Height="*" />
      <RowDefinition Height="Auto" />
    </Grid.RowDefinitions>

    <controls:RangeSelector
        Grid.Row="0"
        Margin="0,0,0,12"
        Minimum="0"
        Maximum="365"
        Header="Stáří dokumentů (dny)"
        LowerValue="{Binding CreatedDaysFrom, Mode=TwoWay}"
        UpperValue="{Binding CreatedDaysTo, Mode=TwoWay}" />

    <ScrollViewer Grid.Row="1">
      <muxc:ItemsRepeater ItemsSource="{Binding Items}">
        <muxc:ItemsRepeater.Layout>
          <muxc:UniformGridLayout
              x:Name="FilesLayout"
              MaximumRowsOrColumns="3"
              MinColumnSpacing="12"
              MinRowSpacing="12" />
        </muxc:ItemsRepeater.Layout>
        <muxc:ItemsRepeater.ItemTemplate>
          <DataTemplate x:DataType="models:FileListItemModel">
            <Border
                Padding="16"
                Margin="8"
                Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                CornerRadius="12">
              <i:Interaction.Behaviors>
                <ctb:EventToCommandBehavior
                    EventName="Tapped"
                    Command="{Binding ElementName=PageRoot, Path=DataContext.OpenDetailCommand}"
                    CommandParameter="{Binding Id}" />
              </i:Interaction.Behaviors>
              <StackPanel Spacing="8">
                <TextBlock Text="{Binding Name}" Style="{ThemeResource BodyStrongTextBlockStyle}" />
                <TextBlock Text="{Binding Author}" Opacity="0.8" />
                <TextBlock Text="{Binding LastModifiedUtc, StringFormat='{}{0:G}'}" Opacity="0.6" />
              </StackPanel>
            </Border>
          </DataTemplate>
        </muxc:ItemsRepeater.ItemTemplate>
      </muxc:ItemsRepeater>
    </ScrollViewer>

    <StackPanel Grid.Row="2" Orientation="Horizontal" Spacing="12" VerticalAlignment="Center">
      <ProgressRing Width="28" Height="28" IsActive="{Binding IsBusy}" />
      <Button Content="Obnovit" Command="{Binding RefreshCommand}" />
      <InfoBar
          x:Name="StatusInfoBar"
          IsOpen="True"
          Severity="{Binding HasError, Converter={StaticResource BoolToSeverityConverter}}"
          Title="Stav">
        <i:Interaction.Behaviors>
          <core:EventTriggerBehavior EventName="Loaded">
            <core:CallMethodAction TargetObject="{Binding ElementName=StatusInfoBar}" MethodName="BringIntoView" />
          </core:EventTriggerBehavior>
        </i:Interaction.Behaviors>
        <StackPanel>
          <TextBlock Text="{Binding StatusMessage}" />
        </StackPanel>
      </InfoBar>
    </StackPanel>

    <VisualStateManager.VisualStateGroups>
      <VisualStateGroup>
        <VisualState x:Name="Narrow">
          <VisualState.StateTriggers>
            <trig:AdaptiveTriggerBehavior MaxWindowWidth="640" />
          </VisualState.StateTriggers>
          <VisualState.Setters>
            <Setter Target="FilesLayout.MaximumRowsOrColumns" Value="1" />
          </VisualState.Setters>
        </VisualState>
        <VisualState x:Name="Wide">
          <VisualState.StateTriggers>
            <trig:AdaptiveTriggerBehavior MinWindowWidth="641" />
          </VisualState.StateTriggers>
          <VisualState.Setters>
            <Setter Target="FilesLayout.MaximumRowsOrColumns" Value="3" />
          </VisualState.Setters>
        </VisualState>
      </VisualStateGroup>
    </VisualStateManager.VisualStateGroups>
  </Grid>
</Page>
