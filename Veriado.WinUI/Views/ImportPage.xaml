<?xml version="1.0" encoding="utf-8"?>
<Page
    x:Class="Veriado.WinUI.Views.ImportPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:converters="using:CommunityToolkit.WinUI.Converters"
    xmlns:core="using:Microsoft.Xaml.Interactions.Core"
    xmlns:ctb="using:CommunityToolkit.WinUI.Behaviors"
    xmlns:i="using:Microsoft.Xaml.Interactivity"
    xmlns:trig="using:CommunityToolkit.WinUI.Triggers"
    xmlns:viewModels="using:Veriado.Presentation.ViewModels"
    xmlns:winui="using:Microsoft.UI.Xaml.Controls"
    x:DataType="viewModels:ImportViewModel">

    <Page.DataContext>
        <x:Bind Path="ViewModel" />
    </Page.DataContext>

    <Page.Resources>
        <converters:ObjectToVisibilityConverter x:Key="ObjectToVisibilityConverter" />
        <converters:BoolToObjectConverter x:Key="InverseBool" TrueValue="False" FalseValue="True" />
    </Page.Resources>

    <Grid Padding="24" RowSpacing="16">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>

        <InfoBar
            IsOpen="{Binding IsInfoBarOpen, Mode=TwoWay}"
            Severity="{Binding HasError, Converter={StaticResource BoolToSeverity}}"
            Title="Stav">
            <StackPanel>
                <TextBlock Text="{Binding StatusMessage}" />
                <TextBlock
                    Text="{Binding LastError}"
                    Foreground="{ThemeResource SystemFillColorCriticalBrush}"
                    Visibility="{Binding LastError, Converter={StaticResource ObjectToVisibilityConverter}}" />
            </StackPanel>
        </InfoBar>

        <StackPanel Grid.Row="1" Spacing="12">
            <StackPanel Orientation="Horizontal" Spacing="12">
                <TextBox
                    Width="360"
                    PlaceholderText="Cílová složka"
                    Text="{Binding FolderRequest.FolderPath, Mode=TwoWay}" />
                <Button Content="Vybrat složku" Command="{Binding BrowseFolderCommand}" />
            </StackPanel>

            <StackPanel Orientation="Horizontal" Spacing="12">
                <TextBox Width="220" PlaceholderText="Výchozí autor" Text="{Binding FolderRequest.DefaultAuthor, Mode=TwoWay}" />
                <TextBox Width="120" PlaceholderText="Maska" Text="{Binding FolderRequest.SearchPattern, Mode=TwoWay}" />
                <winui:NumberBox
                    Width="140"
                    Minimum="1"
                    Maximum="64"
                    Value="{Binding FolderRequest.MaxDegreeOfParallelism, Mode=TwoWay}" />
            </StackPanel>

            <StackPanel Orientation="Horizontal" Spacing="12">
                <CheckBox Content="Extrahovat obsah" IsChecked="{Binding FolderRequest.ExtractContent, Mode=TwoWay}" />
                <CheckBox Content="Rekurzivně" IsChecked="{Binding FolderRequest.Recursive, Mode=TwoWay}" />
            </StackPanel>

            <StackPanel Orientation="Horizontal" Spacing="12" VerticalAlignment="Center">
                <Button Content="Importovat" Command="{Binding ImportCommand}" IsEnabled="{Binding IsImporting, Converter={StaticResource InverseBool}}" />
                <Button Content="Zrušit" Command="{Binding CancelImportCommand}" IsEnabled="{Binding IsImporting}" />
                <ProgressRing Width="32" Height="32" IsActive="{Binding IsImporting}" />
            </StackPanel>
        </StackPanel>

        <StackPanel Grid.Row="2" Spacing="8">
            <TextBlock Text="Souhrn" FontSize="20" FontWeight="SemiBold" />
            <ProgressBar
                Minimum="0"
                Maximum="{Binding Progress.Total}"
                Value="{Binding Progress.Processed}" />
            <TextBlock Text="{Binding Progress.Processed, StringFormat='Úspěšně: {0}'}" />
            <TextBlock Text="{Binding Progress.Total, StringFormat='Celkem: {0}'}" />
        </StackPanel>
    </Grid>
</Page>
