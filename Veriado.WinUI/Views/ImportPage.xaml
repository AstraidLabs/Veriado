<?xml version="1.0" encoding="utf-8"?>
<Page
    x:Class="Veriado.WinUI.Views.ImportPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:controls="using:Microsoft.UI.Xaml.Controls"
    xmlns:converters="using:CommunityToolkit.WinUI.Converters"
    xmlns:viewModels="using:Veriado.WinUI.ViewModels"
    xmlns:winui="using:Microsoft.UI.Xaml.Controls"
    x:DataType="viewModels:ImportViewModel">

    <Page.Resources>
        <converters:BoolToVisibilityConverter x:Key="BoolToVisibilityConverter" />
    </Page.Resources>

    <Grid Padding="24" RowSpacing="16">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>

        <InfoBar
            IsOpen="{x:Bind IsInfoBarOpen, Mode=TwoWay}"
            Severity="{x:Bind !string.IsNullOrEmpty(LastError) ? winui:InfoBarSeverity.Error : winui:InfoBarSeverity.Informational}"
            Title="Stav">
            <StackPanel>
                <TextBlock Text="{x:Bind StatusMessage}" />
                <TextBlock
                    Text="{x:Bind LastError}"
                    Foreground="{ThemeResource SystemFillColorCriticalBrush}"
                    Visibility="{x:Bind !string.IsNullOrEmpty(LastError), Converter={StaticResource BoolToVisibilityConverter}}" />
            </StackPanel>
        </InfoBar>

        <StackPanel Grid.Row="1" Spacing="12">
            <StackPanel Orientation="Horizontal" Spacing="12">
                <TextBox
                    Width="360"
                    PlaceholderText="Cílová složka"
                    Text="{x:Bind SelectedFolderPath, Mode=TwoWay}" />
                <Button Content="Vybrat složku" Command="{x:Bind BrowseFolderCommand}" />
            </StackPanel>

            <StackPanel Orientation="Horizontal" Spacing="12">
                <TextBox Width="220" PlaceholderText="Výchozí autor" Text="{x:Bind DefaultAuthor, Mode=TwoWay}" />
                <TextBox Width="120" PlaceholderText="Maska" Text="{x:Bind SearchPattern, Mode=TwoWay}" />
                <controls:NumberBox
                    Width="140"
                    Minimum="1"
                    Maximum="64"
                    Value="{x:Bind MaxDegreeOfParallelism, Mode=TwoWay}" />
            </StackPanel>

            <StackPanel Orientation="Horizontal" Spacing="12">
                <CheckBox Content="Extrahovat obsah" IsChecked="{x:Bind ExtractContent, Mode=TwoWay}" />
                <CheckBox Content="Rekurzivně" IsChecked="{x:Bind Recursive, Mode=TwoWay}" />
            </StackPanel>

            <StackPanel Orientation="Horizontal" Spacing="12" VerticalAlignment="Center">
                <Button Content="Importovat" Command="{x:Bind ImportCommand}" />
                <Button Content="Zrušit" Command="{x:Bind CancelImportCommand}" />
                <ProgressRing Width="32" Height="32" IsActive="{x:Bind IsImporting}" />
            </StackPanel>
        </StackPanel>

        <StackPanel Grid.Row="2" Spacing="8">
            <TextBlock Text="Souhrn" FontSize="20" FontWeight="SemiBold" />
            <ProgressBar
                Minimum="0"
                Maximum="{x:Bind Total, Mode=OneWay}"
                Value="{x:Bind Processed, Mode=OneWay}" />
            <TextBlock Text="{x:Bind Processed, StringFormat='Úspěšně: {0}'}" />
            <TextBlock Text="{x:Bind Total, StringFormat='Celkem: {0}'}" />
        </StackPanel>
    </Grid>
</Page>
