<ContentDialog
    x:Class="Veriado.WinUI.Views.Files.FileDetailDialog"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:converters="using:Veriado.WinUI.Converters"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    mc:Ignorable="d"
    x:Name="RootDialog"
    x:Uid="FileDetailDialog"
    MinWidth="360"
    MaxWidth="920"
    DefaultButton="Primary"
    IsPrimaryButtonEnabled="{x:Bind ViewModel.CanSave, Mode=OneWay}">
    <ContentDialog.Resources>
        <converters:SizeToHumanConverter x:Key="SizeToHumanConverter" />
        <converters:NullableDateTimeOffsetConverter x:Key="NullableDateTimeOffsetConverter" />
    </ContentDialog.Resources>

    <Grid x:Name="LayoutRoot" RowSpacing="16">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>

        <VisualStateManager.VisualStateGroups>
            <VisualStateGroup x:Name="WidthStates">
                <VisualState x:Name="Narrow">
                    <VisualState.Setters>
                        <Setter Target="ValidityColumnLeft.Width" Value="*" />
                        <Setter Target="ValidityColumnRight.Width" Value="0" />
                        <Setter Target="ValidityValidFromPanel.(Grid.ColumnSpan)" Value="2" />
                        <Setter Target="ValidityValidToPanel.(Grid.Column)" Value="0" />
                        <Setter Target="ValidityValidToPanel.(Grid.Row)" Value="1" />
                        <Setter Target="ValidityValidToPanel.(Grid.ColumnSpan)" Value="2" />
                        <Setter Target="CopiesColumnLeft.Width" Value="*" />
                        <Setter Target="CopiesColumnRight.Width" Value="0" />
                        <Setter Target="CopiesPhysicalPanel.(Grid.ColumnSpan)" Value="2" />
                        <Setter Target="CopiesElectronicPanel.(Grid.Column)" Value="0" />
                        <Setter Target="CopiesElectronicPanel.(Grid.Row)" Value="1" />
                        <Setter Target="CopiesElectronicPanel.(Grid.ColumnSpan)" Value="2" />
                    </VisualState.Setters>
                </VisualState>

                <VisualState x:Name="Wide">
                    <VisualState.Setters>
                        <Setter Target="ValidityColumnLeft.Width" Value="*" />
                        <Setter Target="ValidityColumnRight.Width" Value="0" />
                        <Setter Target="ValidityValidFromPanel.(Grid.ColumnSpan)" Value="2" />
                        <Setter Target="ValidityValidToPanel.(Grid.Column)" Value="0" />
                        <Setter Target="ValidityValidToPanel.(Grid.Row)" Value="1" />
                        <Setter Target="ValidityValidToPanel.(Grid.ColumnSpan)" Value="2" />
                        <Setter Target="CopiesColumnLeft.Width" Value="*" />
                        <Setter Target="CopiesColumnRight.Width" Value="*" />
                        <Setter Target="CopiesPhysicalPanel.(Grid.ColumnSpan)" Value="1" />
                        <Setter Target="CopiesElectronicPanel.(Grid.Column)" Value="1" />
                        <Setter Target="CopiesElectronicPanel.(Grid.Row)" Value="0" />
                        <Setter Target="CopiesElectronicPanel.(Grid.ColumnSpan)" Value="1" />
                    </VisualState.Setters>
                </VisualState>
            </VisualStateGroup>
        </VisualStateManager.VisualStateGroups>

        <Grid Grid.Row="0" ColumnSpacing="12" VerticalAlignment="Center">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="Auto" />
            </Grid.ColumnDefinitions>
            <StackPanel Orientation="Vertical" Spacing="4">
                <TextBlock
                    Text="{x:Bind ViewModel.File.DisplayName, Mode=OneWay}"
                    FontSize="24"
                    FontWeight="SemiBold"
                    TextWrapping="Wrap" />
                <TextBlock Text="{x:Bind ViewModel.File.MimeType, Mode=OneWay}" TextWrapping="Wrap" />
            </StackPanel>
            <ProgressRing
                Grid.Column="1"
                Width="28"
                Height="28"
                IsActive="{x:Bind ViewModel.IsBusy, Mode=OneWay}" />
        </Grid>

        <ScrollViewer
            Grid.Row="1"
            HorizontalScrollBarVisibility="Disabled"
            VerticalScrollBarVisibility="Auto"
            ZoomMode="Disabled">
            <StackPanel Spacing="20" Padding="16">
                <StackPanel Spacing="8">
                    <TextBlock Text="Souhrn" FontWeight="SemiBold" />
                    <StackPanel Orientation="Horizontal" Spacing="4">
                        <TextBlock Text="Velikost:" FontWeight="SemiBold" />
                        <TextBlock
                            Text="{x:Bind ViewModel.File.Size, Mode=OneWay, Converter={StaticResource SizeToHumanConverter}}"
                            TextWrapping="Wrap" />
                    </StackPanel>
                    <StackPanel Orientation="Horizontal" Spacing="4">
                        <TextBlock Text="Vytvořeno:" FontWeight="SemiBold" />
                        <TextBlock Text="{x:Bind ViewModel.File.CreatedAt.ToString(), Mode=OneWay}" TextWrapping="Wrap" />
                    </StackPanel>
                    <StackPanel Orientation="Horizontal" Spacing="4">
                        <TextBlock Text="Upraveno:" FontWeight="SemiBold" />
                        <TextBlock Text="{x:Bind ViewModel.File.ModifiedAt.ToString(), Mode=OneWay}" TextWrapping="Wrap" />
                    </StackPanel>
                    <StackPanel Orientation="Horizontal" Spacing="4">
                        <TextBlock Text="Verze:" FontWeight="SemiBold" />
                        <TextBlock Text="{x:Bind ViewModel.File.Version, Mode=OneWay}" TextWrapping="Wrap" />
                    </StackPanel>
                </StackPanel>

                <StackPanel Spacing="12">
                    <TextBlock Text="Metadata" FontWeight="SemiBold" />
                    <TextBox
                        Header="Název souboru"
                        Text="{x:Bind ViewModel.File.FileName, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                        IsEnabled="{x:Bind ViewModel.CanEditFields, Mode=OneWay}" />
                    <ItemsControl ItemsSource="{x:Bind ViewModel.FileNameErrors, Mode=OneWay}">
                        <ItemsControl.ItemTemplate>
                            <DataTemplate x:DataType="x:String">
                                <TextBlock
                                    Foreground="{ThemeResource SystemFillColorCriticalBrush}"
                                    FontSize="12"
                                    Text="{x:Bind}"
                                    TextWrapping="Wrap" />
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>

                    <TextBox
                        Header="MIME"
                        Text="{x:Bind ViewModel.File.MimeType, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                        IsEnabled="{x:Bind ViewModel.CanEditFields, Mode=OneWay}" />
                    <ItemsControl ItemsSource="{x:Bind ViewModel.MimeTypeErrors, Mode=OneWay}">
                        <ItemsControl.ItemTemplate>
                            <DataTemplate x:DataType="x:String">
                                <TextBlock
                                    Foreground="{ThemeResource SystemFillColorCriticalBrush}"
                                    FontSize="12"
                                    Text="{x:Bind}"
                                    TextWrapping="Wrap" />
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>

                    <TextBox
                        Header="Autor"
                        Text="{x:Bind ViewModel.File.Author, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                        IsEnabled="{x:Bind ViewModel.CanEditFields, Mode=OneWay}" />
                    <ItemsControl ItemsSource="{x:Bind ViewModel.AuthorErrors, Mode=OneWay}">
                        <ItemsControl.ItemTemplate>
                            <DataTemplate x:DataType="x:String">
                                <TextBlock
                                    Foreground="{ThemeResource SystemFillColorCriticalBrush}"
                                    FontSize="12"
                                    Text="{x:Bind}"
                                    TextWrapping="Wrap" />
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>

                    <ToggleSwitch
                        Header="Pouze pro čtení"
                        MinWidth="200"
                        IsOn="{x:Bind ViewModel.File.IsReadOnly, Mode=TwoWay}"
                        IsEnabled="{x:Bind ViewModel.CanEditFields, Mode=OneWay}" />
                </StackPanel>

                <StackPanel Spacing="12">
                    <TextBlock Text="Platnost" FontWeight="SemiBold" />
                    <Button
                        Content="Zrušit platnost"
                        Command="{x:Bind ViewModel.ClearValidityCommand, Mode=OneWay}"
                        IsEnabled="{x:Bind ViewModel.CanClearValidity, Mode=OneWay}" />
                    <Grid x:Name="ValidityGrid" ColumnSpacing="12" RowSpacing="12">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="Auto" />
                        </Grid.RowDefinitions>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition x:Name="ValidityColumnLeft" Width="*" />
                            <ColumnDefinition x:Name="ValidityColumnRight" Width="0" />
                        </Grid.ColumnDefinitions>
                        <StackPanel
                            x:Name="ValidityValidFromPanel"
                            Grid.Column="0"
                            Grid.Row="0"
                            Grid.ColumnSpan="2"
                            Spacing="4">
                            <TextBlock Text="Platí od" />
                            <DatePicker
                                MinWidth="200"
                                Date="{x:Bind ViewModel.File.ValidFrom, Mode=TwoWay, Converter={StaticResource NullableDateTimeOffsetConverter}, UpdateSourceTrigger=PropertyChanged}"
                                IsEnabled="{x:Bind ViewModel.CanEditFields, Mode=OneWay}" />
                            <ItemsControl ItemsSource="{x:Bind ViewModel.ValidFromErrors, Mode=OneWay}">
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate x:DataType="x:String">
                                        <TextBlock
                                            Foreground="{ThemeResource SystemFillColorCriticalBrush}"
                                            FontSize="12"
                                            Text="{x:Bind}"
                                            TextWrapping="Wrap" />
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>
                        </StackPanel>
                        <StackPanel
                            x:Name="ValidityValidToPanel"
                            Grid.Column="0"
                            Grid.Row="1"
                            Grid.ColumnSpan="2"
                            Spacing="4">
                            <TextBlock Text="Platí do" />
                            <DatePicker
                                MinWidth="200"
                                Date="{x:Bind ViewModel.File.ValidTo, Mode=TwoWay, Converter={StaticResource NullableDateTimeOffsetConverter}, UpdateSourceTrigger=PropertyChanged}"
                                IsEnabled="{x:Bind ViewModel.CanEditFields, Mode=OneWay}" />
                            <ItemsControl ItemsSource="{x:Bind ViewModel.ValidToErrors, Mode=OneWay}">
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate x:DataType="x:String">
                                        <TextBlock
                                            Foreground="{ThemeResource SystemFillColorCriticalBrush}"
                                            FontSize="12"
                                            Text="{x:Bind}"
                                            TextWrapping="Wrap" />
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>
                        </StackPanel>
                    </Grid>
                    <Grid x:Name="CopiesGrid" ColumnSpacing="12" RowSpacing="12">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="Auto" />
                        </Grid.RowDefinitions>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition x:Name="CopiesColumnLeft" Width="*" />
                            <ColumnDefinition x:Name="CopiesColumnRight" Width="*" />
                        </Grid.ColumnDefinitions>
                        <StackPanel x:Name="CopiesPhysicalPanel" Grid.Column="0" Grid.Row="0" Spacing="4">
                            <ToggleSwitch
                                Header="Fyzická kopie"
                                MinWidth="200"
                                IsOn="{x:Bind ViewModel.File.HasPhysicalCopy, Mode=TwoWay}"
                                IsEnabled="{x:Bind ViewModel.CanEditFields, Mode=OneWay}" />
                            <ItemsControl ItemsSource="{x:Bind ViewModel.PhysicalCopyErrors, Mode=OneWay}">
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate x:DataType="x:String">
                                        <TextBlock
                                            Foreground="{ThemeResource SystemFillColorCriticalBrush}"
                                            FontSize="12"
                                            Text="{x:Bind}"
                                            TextWrapping="Wrap" />
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>
                        </StackPanel>
                        <StackPanel x:Name="CopiesElectronicPanel" Grid.Column="1" Grid.Row="0" Spacing="4">
                            <ToggleSwitch
                                Header="Elektronická kopie"
                                MinWidth="200"
                                IsOn="{x:Bind ViewModel.File.HasElectronicCopy, Mode=TwoWay}"
                                IsEnabled="{x:Bind ViewModel.CanEditFields, Mode=OneWay}" />
                            <ItemsControl ItemsSource="{x:Bind ViewModel.ElectronicCopyErrors, Mode=OneWay}">
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate x:DataType="x:String">
                                        <TextBlock
                                            Foreground="{ThemeResource SystemFillColorCriticalBrush}"
                                            FontSize="12"
                                            Text="{x:Bind}"
                                            TextWrapping="Wrap" />
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>
                        </StackPanel>
                    </Grid>
                </StackPanel>

                <InfoBar
                    IsClosable="False"
                    IsOpen="{x:Bind ViewModel.HasErrorMessage, Mode=OneWay}"
                    Severity="Error"
                    Title="Chyba"
                    Message="{x:Bind ViewModel.ErrorMessage, Mode=OneWay}" />
            </StackPanel>
        </ScrollViewer>
    </Grid>
</ContentDialog>
