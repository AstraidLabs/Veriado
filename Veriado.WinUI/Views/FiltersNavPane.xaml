<UserControl
    x:Class="Veriado.WinUI.Views.FiltersNavPane"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:contracts="using:Veriado.Contracts.Search"
    xmlns:conv="using:Veriado.WinUI.Converters"
    xmlns:winui="using:Microsoft.UI.Xaml.Controls">

    <UserControl.Resources>
        <conv:DateTimeToRelativeConverter x:Key="RelativeConverter" />
    </UserControl.Resources>

    <Grid x:Name="Root"
          Padding="16"
          RowSpacing="12"
          Loaded="Root_Loaded"
          Unloaded="Root_Unloaded">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>

        <StackPanel Spacing="12">
            <AutoSuggestBox x:Name="SearchBox"
                            PlaceholderText="Hledat dokumenty"
                            QueryIcon="Find"
                            Text="{Binding SearchText, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                            ItemsSource="{Binding SearchSuggestions}"
                            QuerySubmitted="SearchBox_QuerySubmitted"
                            SuggestionChosen="SearchBox_SuggestionChosen" />

            <StackPanel Orientation="Horizontal" Spacing="8">
                <Button Content="Uložit pohled"
                        Command="{Binding SaveCurrentQueryCommand}" />
                <Button Content="Vymazat historii"
                        Command="{Binding ClearHistoryCommand}" />
            </StackPanel>
        </StackPanel>

        <winui:Expander Grid.Row="1" Header="Oblíbené" IsExpanded="True">
            <winui:ListView x:Name="FavoritesList"
                            ItemsSource="{Binding Favorites}"
                            SelectionMode="None"
                            IsItemClickEnabled="True"
                            ItemClick="FavoritesList_ItemClick">
                <winui:ListView.ItemTemplate>
                    <DataTemplate x:DataType="contracts:SearchFavoriteItem">
                        <StackPanel Spacing="4">
                            <TextBlock Text="{x:Bind Name, Mode=OneWay}" FontWeight="SemiBold" />
                            <TextBlock Text="{x:Bind QueryText, Mode=OneWay}" Style="{ThemeResource CaptionTextBlockStyle}" />
                        </StackPanel>
                    </DataTemplate>
                </winui:ListView.ItemTemplate>
            </winui:ListView>
        </winui:Expander>

        <winui:Expander Grid.Row="2" Header="Historie" IsExpanded="False">
            <winui:ListView x:Name="HistoryList"
                            ItemsSource="{Binding History}"
                            SelectionMode="None"
                            IsItemClickEnabled="True"
                            ItemClick="HistoryList_ItemClick">
                <winui:ListView.ItemTemplate>
                    <DataTemplate x:DataType="contracts:SearchHistoryEntry">
                        <StackPanel Spacing="4">
                            <TextBlock Text="{x:Bind QueryText, Mode=OneWay}" FontWeight="SemiBold" />
                            <TextBlock Text="{Binding LastQueriedUtc, Converter={StaticResource RelativeConverter}}"
                                       Style="{ThemeResource CaptionTextBlockStyle}" />
                        </StackPanel>
                    </DataTemplate>
                </winui:ListView.ItemTemplate>
            </winui:ListView>
        </winui:Expander>
    </Grid>
</UserControl>
